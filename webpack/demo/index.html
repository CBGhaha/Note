<!DOCTYPE html>
<html lang="en" dir="ltr">
  <head>
    <meta charset="utf-8">
    <title></title>
  </head>
  <body>
      <div id='add_chunk'>
        点击加载chunk
      </div>
  </body>
</html>
<script type="text/javascript">
// // webpack启动代码
// (function (modules) {
//   // 模块缓存对象
//   var installedModules = {};
//   // webpack实现的require函数
//   function __webpack_require__(moduleId) {
//       // 检查缓存对象，看模块是否加载过
//       if (installedModules[moduleId]) {
//           return installedModules[moduleId].exports;
//       }
//       // 创建一个新的模块缓存，再存入缓存对象
//       var module = installedModules[moduleId] = {
//           i: moduleId,
//           l: false,
//           exports: {}
//       };
//       // 执行模块代码
//       modules[moduleId].call(module.exports, module, module.exports, __webpack_require__);
//       // 将模块标识为已加载
//       module.l = true;
//       // 返回export的内容
//       return module.exports;
//   }
//   // 加载入口模块
//   return __webpack_require__(__webpack_require__.s = 0);
// })
// ([
//     /* 0 */
//     (function (module, __webpack_exports__, __webpack_require__) {
//         "use strict";
//         Object.defineProperty(__webpack_exports__, "__esModule", {
//             value: true
//         });
//         /* harmony import */
//         var __WEBPACK_IMPORTED_MODULE_0__logger__ = __webpack_require__(1);
//         console.log('Hello Dickens');
//         Object(__WEBPACK_IMPORTED_MODULE_0__logger__["a" /* default */ ])();
//     }),
//     /* 1 */
//     (function (module, __webpack_exports__, __webpack_require__) {
//         "use strict";
//         /* harmony export (immutable) */
//         __webpack_exports__["a"] = log;
//         function log() {
//             console.log('Log from logger');
//         }
//     })
// ]);
(function (modules) {
    // 加载成功后的JSONP回调函数
    var parentJsonpFunction = window["webpackJsonp"];
    // 加载成功后的JSONP回调函数
    window["webpackJsonp"] = function webpackJsonpCallback(chunkIds, moreModules, executeModules) {
        var moduleId, chunkId, i = 0,
            resolves = [],
            result;
        for (; i < chunkIds.length; i++) {
            chunkId = chunkIds[i];
            // installedChunks[chunkId]不为0且不为undefined，将其放入加载成功数组
            if (installedChunks[chunkId]) {
                // promise的resolve
                resolves.push(installedChunks[chunkId][0]);
            }
            // 标记模块加载完成
            installedChunks[chunkId] = 0;
        }
        // 将动态加载的模块添加到modules数组中，以供后续的require使用
        for (moduleId in moreModules) {
            if (Object.prototype.hasOwnProperty.call(moreModules, moduleId)) {
                modules[moduleId] = moreModules[moduleId];
            }
        }
        if (parentJsonpFunction) parentJsonpFunction(chunkIds, moreModules, executeModules);
        while (resolves.length) {
            resolves.shift()();
        }
    };

    // 模块缓存对象
    var installedModules = {};

    // 记录正在加载和已经加载的chunk的对象，0表示已经加载成功
    // 1是当前模块的编号，已加载完成
    var installedChunks = {
        1: 0
    };

    // require函数，跟上面的一样
    function __webpack_require__(moduleId) {
        if (installedModules[moduleId]) {
            return installedModules[moduleId].exports;
        }

        var module = installedModules[moduleId] = {
            i: moduleId,
            l: false,
            exports: {}
        };

        modules[moduleId].call(module.exports, module, module.exports, __webpack_require__);

        module.l = true;

        return module.exports;
    }

    // 按需加载，通过动态添加script标签实现
    __webpack_require__.e = function requireEnsure(chunkId) {
        var installedChunkData = installedChunks[chunkId];

        // chunk已经加载成功
        if (installedChunkData === 0) {
            return new Promise(function (resolve) {
                resolve();
            });
        }

        // 加载中，返回之前创建的promise（数组下标为2）
        if (installedChunkData) {
            return installedChunkData[2];
        }

        // 将promise相关函数保持到installedChunks中方便后续resolve或reject
        var promise = new Promise(function (resolve, reject) {
            installedChunkData = installedChunks[chunkId] = [resolve, reject];
        });
        installedChunkData[2] = promise;

        // 启动chunk的异步加载
        var head = document.getElementsByTagName('head')[0];
        var script = document.createElement('script');
        script.type = 'text/javascript';
        script.charset = 'utf-8';
        script.async = true;
        script.timeout = 120000;
        if (__webpack_require__.nc) {
            script.setAttribute("nonce", __webpack_require__.nc);
        }
        script.src = "" + chunkId + ".bundle_async.js";
        script.onerror = script.onload = onScriptComplete;
        var timeout = setTimeout(onScriptComplete, 120000);

        function onScriptComplete() {
            script.onerror = script.onload = null;
            clearTimeout(timeout);
            var chunk = installedChunks[chunkId];
            // 正常的流程，模块加载完后会调用webpackJsonp方法，将chunk置为0
            // 如果不为0，则可能是加载失败或者超时
            if (chunk !== 0) {
                if (chunk) {
                    // 调用promise的reject
                    chunk[1](new Error('Loading chunk ' + chunkId + ' failed.'));
                }
                installedChunks[chunkId] = undefined;
            }
        };
        head.appendChild(script);
        return promise;
    };

    // 加载入口模块
    return __webpack_require__(__webpack_require__.s = 0);
})
([
    /* 0 */
    (function (module, exports, __webpack_require__) {
        console.log('Hello Dickens');
        var add_chunk=document.getElementById('add_chunk');
        add_chunk.onclick=function(){
          __webpack_require__.e /* import() */(0)
          .then(__webpack_require__.bind(null, 1))
          .then(logger => {
              logger.default();
          });
        }
        // promise resolve后，会指定加载哪个模块

    })
]);
</script>
